<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Event Consistency Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem 3rem;
      line-height: 1.5;
    }
    h1 {
      font-size: 1.7rem;
      margin-bottom: 0.25rem;
    }
    h2 {
      font-size: 1.1rem;
      margin-top: 1.75rem;
    }
    textarea {
      width: 100%;
      min-height: 140px;
      padding: 0.5rem;
      box-sizing: border-box;
      font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.9rem;
    }
    button {
      margin-top: 0.75rem;
      padding: 0.5rem 1.1rem;
      border-radius: 4px;
      border: 1px solid #ddd;
      background: #f5f5f5;
      cursor: pointer;
      font-size: 0.95rem;
    }
    button:hover {
      background: #e9e9e9;
    }
    .output {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 4px;
      background: #fafafa;
      border: 1px solid #e4e4e4;
      white-space: pre-wrap;
      font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.9rem;
    }
    .meta {
      font-size: 0.85rem;
      color: #666;
      margin-top: 0.25rem;
      margin-bottom: 1rem;
    }
    .hint {
      font-size: 0.85rem;
      color: #777;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body>
  <h1>Event Consistency Checker</h1>
  <p class="meta">
    A tiny interactive tool to compare two JSON events and surface basic inconsistencies between their fields, naming, and types.
  </p>

  <h2>Event A</h2>
  <textarea id="event-a-input">{
  "user_id": 123,
  "action": "login",
  "timestamp": "2025-11-22T15:00:00Z"
}</textarea>

  <h2>Event B</h2>
  <textarea id="event-b-input">{
  "userId": "123",
  "type": "LOGIN",
  "timestamp": "2025-11-22T15:00:00Z"
}</textarea>

  <button id="check-btn">Check Consistency</button>
  <p class="hint">Paste or edit JSON for each event, then click "Check Consistency".</p>

  <div id="output" class="output">
Click "Check Consistency" to see issues and a simple consistency summary.
  </div>

  <script>
    function safeParse(jsonText) {
      try {
        return { ok: true, value: JSON.parse(jsonText) };
      } catch (e) {
        return { ok: false, error: e.message };
      }
    }

    function compareEvents(eventA, eventB) {
      const issues = [];
      const keysA = Object.keys(eventA);
      const keysB = Object.keys(eventB);

      const onlyA = new Set(keysA);
      const onlyB = new Set(keysB);

      // Special-case: user_id vs userId naming difference
      if (Object.prototype.hasOwnProperty.call(eventA, "user_id") &&
          Object.prototype.hasOwnProperty.call(eventB, "userId")) {
        issues.push("Field name mismatch: user_id (Event A) vs userId (Event B)");
        onlyA.delete("user_id");
        onlyB.delete("userId");

        // Type check for this conceptual "user" field
        const typeA = typeof eventA["user_id"];
        const typeB = typeof eventB["userId"];
        if (typeA !== typeB) {
          issues.push("Type mismatch for user/user_id: " + typeA + " vs " + typeB);
        }
      }

      // Keys present in both with same spelling
      keysA.forEach(function (key) {
        if (keysB.includes(key)) {
          onlyA.delete(key);
          onlyB.delete(key);

          const typeA = typeof eventA[key];
          const typeB = typeof eventB[key];
          if (typeA !== typeB) {
            issues.push("Type mismatch for \"" + key + "\": " + typeA + " vs " + typeB);
          }
        }
      });

      // Fields only in Event A
      onlyA.forEach(function (key) {
        issues.push("Field only in Event A: " + key);
      });

      // Fields only in Event B
      onlyB.forEach(function (key) {
        issues.push("Field only in Event B: " + key);
      });

      let consistency = "High";
      if (issues.length >= 1 && issues.length <= 2) {
        consistency = "Medium";
      } else if (issues.length > 2) {
        consistency = "Low";
      }

      return {
        issues,
        consistency
      };
    }

    function formatResult(result) {
      const lines = [];

      if (result.issues.length === 0) {
        lines.push("No inconsistencies detected.");
      } else {
        lines.push("Inconsistencies Detected:");
        result.issues.forEach(function (issue) {
          lines.push("- " + issue);
        });
      }

      lines.push("");
      lines.push("Consistency: " + result.consistency);
      lines.push("Issues: " + result.issues.length);

      return lines.join("\n");
    }

    document.getElementById("check-btn").addEventListener("click", function () {
      const textA = document.getElementById("event-a-input").value || "";
      const textB = document.getElementById("event-b-input").value || "";

      const parsedA = safeParse(textA);
      const parsedB = safeParse(textB);

      if (!parsedA.ok || !parsedB.ok) {
        let msg = "Error parsing JSON:\n";
        if (!parsedA.ok) {
          msg += "- Event A: " + parsedA.error + "\n";
        }
        if (!parsedB.ok) {
          msg += "- Event B: " + parsedB.error + "\n";
        }
        document.getElementById("output").textContent = msg.trim();
        return;
      }

      const result = compareEvents(parsedA.value, parsedB.value);
      document.getElementById("output").textContent = formatResult(result);
    });
  </script>
</body>
</html>
